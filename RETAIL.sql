CREATE DATABASE PROJECTS;
USE PROJECTS;

CREATE TABLE RETAIL(
CUSTOMER_ID INT,
ORDER_DATE DATE,
PRODUCT_ID INT,
CATEGORY_ID INT,
CATEGORY_NAME VARCHAR(30),
PRODUCT_NAME VARCHAR(30),
QUANTITY INT,
PRICE FLOAT,
PAYMENT_METHOD VARCHAR(30),
CITY VARCHAR(30),
REVIEW_SCORE INT,
GENDER VARCHAR(30),
AGE INT);

-- IDENTIFYING NULL VALUES
SELECT * FROM RETAIL WHERE CUSTOMER_ID IS NULL
OR ORDER_DATE IS NULL 
OR PRODUCT_ID IS NULL
OR CATEGORY_ID IS NULL
OR CATEGORY_NAME IS NULL
OR PRODUCT_NAME IS NULL
OR QUANTITY IS NULL
OR PRICE IS NULL
OR PAYMENT_METHOD IS NULL
OR CITY IS NULL
OR REVIEW_SCORE IS NULL
OR GENDER IS NULL
OR AGE IS NULL;

-- NULL HANDLING
-- DATA STORED AS STRING INSTEAD OF NULL
SELECT * FROM RETAIL WHERE GENDER = "";
SET SQL_SAFE_UPDATES = 0;
UPDATE RETAIL SET GENDER = NULL WHERE GENDER = "";
SELECT * FROM RETAIL WHERE GENDER IS NULL;
UPDATE RETAIL SET GENDER  = "OTHERS" WHERE GENDER IS NULL;

UPDATE RETAIL SET REVIEW_SCORE  = "NOT GIVEN" WHERE REVIEW_SCORE = "";
SELECT * FROM RETAIL WHERE GENDER IS NULL;

-- FIND THE TOTAL NUMBER OF ORDERS IN THE DATASET.
SELECT COUNT(*) FROM RETAIL;

-- RETRIEVE ALL ORDERS PLACED IN 2024.
SELECT * FROM RETAIL WHERE YEAR(ORDER_DATE) = "2024";

-- LIST ALL DISTINCT CITIES WHERE ORDERS WERE PLACED.
SELECT DISTINCT CITY FROM RETAIL;

-- SHOW ALL ORDERS WHERE THE PAYMENT METHOD IS CREDIT CARD.
SELECT * FROM RETAIL WHERE PAYMENT_METHOD = "CREDIT CARD";

-- FIND ALL CUSTOMERS OLDER THAN 50 YEARS.
SELECT * FROM RETAIL WHERE AGE >50;

-- CALCULATE THE TOTAL REVENUE FOR ALL ORDERS.
SELECT ROUND(SUM(QUANTITY * PRICE),2) AS TOTAL_REVENUE FROM RETAIL;

-- FIND THE TOTAL REVENUE GENERATED BY EACH CATEGORY_NAME.
SELECT CATEGORY_NAME, 
	ROUND(SUM(QUANTITY * PRICE),1) AS REVENUE_CATEGORY
    FROM RETAIL GROUP BY CATEGORY_NAME;

-- COUNT THE NUMBER OF ORDERS PER CITY AND MORETHAN ONE COUNT.
SELECT CITY,COUNT(CITY) ORDERPER_CITY
 FROM RETAIL GROUP BY CITY HAVING ORDERPER_CITY>1;

-- FIND THE AVERAGE REVIEW_SCORE FOR EACH PRODUCT_NAME.
SELECT PRODUCT_NAME, ROUND(AVG(REVIEW_SCORE),2) AS SCORE
FROM RETAIL GROUP BY PRODUCT_NAME;

-- CALCULATE THE TOTAL QUANTITY SOLD FOR EACH PRODUCT.
SELECT PRODUCT_NAME, SUM(QUANTITY) AS TOTAL_QUANTITY_PRODUCT
FROM RETAIL GROUP BY PRODUCT_NAME;

-- RETRIEVE ORDERS WHERE THE REVIEW_SCORE IS LESS THAN 3.
SELECT * FROM RETAIL WHERE REVIEW_SCORE <3.0;

-- FIND ALL ORDERS WHERE CUSTOMERS ARE FEMALE AND AGE > 40.
SELECT * FROM RETAIL 
WHERE GENDER = "F" AND AGE > 40;

SELECT COUNT(*)  FROM RETAIL WHERE GENDER = "F" OR GENDER = "M" OR GENDER = "";
SELECT * FROM RETAIL WHERE GENDER = "";
SELECT COUNT(*) FROM RETAIL WHERE REVIEW_SCORE = "";

-- SHOW PRODUCTS THAT WERE SOLD IN QUANTITIES GREATER THAN 3.
SELECT PRODUCT_NAME,QUANTITY FROM RETAIL WHERE QUANTITY > 3;

-- FIND ORDERS FROM CITIES STARTING WITH THE LETTER 'N'.
SELECT * FROM RETAIL WHERE CITY REGEXP "^N";

-- RETRIEVE ORDERS PLACED BETWEEN JUNE 1, 2024 AND DECEMBER 31, 2024.
SELECT * FROM RETAIL WHERE
ORDER_DATE BETWEEN "2024-06-01" AND "2024-12-31";

-- FIND THE TOP 3 HIGHEST REVENUE-GENERATING PRODUCTS.
SELECT PRODUCT_NAME, ROUND(SUM(QUANTITY * PRICE),2) AS HIGH_REV_PROD
FROM RETAIL GROUP BY PRODUCT_NAME 
ORDER BY HIGH_REV_PROD LIMIT 3;

-- CALCULATE TOTAL REVENUE BY GENDER.
SELECT GENDER, ROUND(SUM(QUANTITY * PRICE),2) AS HREV_GEN
FROM RETAIL GROUP BY GENDER 
ORDER BY GENDER;

-- FIND THE MOST FREQUENTLY USED PAYMENT_METHOD.
SELECT PAYMENT_METHOD, COUNT(PAYMENT_METHOD) AS FREQUENT_METHOD
FROM RETAIL GROUP BY PAYMENT_METHOD
ORDER BY FREQUENT_METHOD DESC LIMIT 1;

-- IDENTIFY THE CITY WITH THE HIGHEST TOTAL SALES REVENUE.
SELECT CITY, 
ROUND(SUM(QUANTITY * PRICE),2) AS HIGHEST_CITY_SALES
FROM RETAIL GROUP BY CITY
ORDER BY HIGHEST_CITY_SALES DESC LIMIT 1;

-- CALCULATE THE AVERAGE AGE OF CUSTOMERS PER CATEGORY.
SELECT CATEGORY_NAME, AVG(AGE) AS AVERAGE_AGE
FROM RETAIL GROUP BY CATEGORY_NAME;

-- RANK PRODUCTS BY TOTAL REVENUE WITHIN EACH CATEGORY.
SELECT CATEGORY_NAME, PRODUCT_NAME,
    ROUND(SUM(QUANTITY * PRICE), 2) AS TOTAL_REVENUE,
    RANK() OVER (PARTITION BY CATEGORY_NAME ORDER BY SUM(QUANTITY * PRICE) DESC) 
    AS REVENUE_RANK FROM RETAIL 
    GROUP BY CATEGORY_NAME, PRODUCT_NAME;

-- FIND CUSTOMERS WHO HAVE PLACED MORE THAN ONE ORDER.
SELECT COUNT(DISTINCT CUSTOMER_ID) FROM RETAIL;

-- CALCULATE MONTH-WISE REVENUE FOR 2024.
SELECT MONTH(ORDER_DATE),
ROUND(SUM(QUANTITY * PRICE)) AS MONTH_WISE_REVENUE
FROM  RETAIL WHERE YEAR(ORDER_DATE) = "2024"
 GROUP BY MONTH(ORDER_DATE)
 ORDER BY MONTH(ORDER_DATE);

-- FIND THE PERCENTAGE CONTRIBUTION OF EACH CATEGORY TO TOTAL REVENUE.
SELECT CATEGORY_NAME, ROUND(SUM(QUANTITY * PRICE)) AS TOTAL_REVENUE,
CATEGORY_REVENUE/ROUND(SUM(QUANTITY * PRICE)) *100 AS TOTAL_REVENUE
FROM RETAIL GROUP BY CATEGORY_NAME;

SELECT 
    CATEGORY_NAME,
    ROUND(SUM(QUANTITY * PRICE), 2) AS TOTAL_REVENUE,
    ROUND((SUM(QUANTITY * PRICE) / 
        (SELECT SUM(QUANTITY * PRICE) FROM RETAIL)) * 100, 
    2) AS PERCENTAGE_CONTRIBUTION
FROM RETAIL
GROUP BY CATEGORY_NAME
ORDER BY PERCENTAGE_CONTRIBUTION DESC;

